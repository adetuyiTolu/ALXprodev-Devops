#!/bin/bash

# Output CSV file
output_csv="pokemon_report.csv"

# Write header
echo "Name,Height(m),Weight(kg)" > "$output_csv"

# Loop through all JSON files
for file in *.json; do
    if [ -f "$file" ]; then
        name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')   # sed capitalizes first letter
        height=$(jq -r '.height' "$file")
        weight=$(jq -r '.weight' "$file")

        # Convert units
        height_m=$(awk -v h="$height" 'BEGIN { printf "%.2f", h/10 }')
        weight_kg=$(awk -v w="$weight" 'BEGIN { printf "%.2f", w/10 }')

        echo "$name,$height_m,$weight_kg" >> "$output_csv"
    fi
done

# Calculate averages and format with sed
awk -F, 'NR>1 && NF==3 { total_height += $2; total_weight += $3; count++ }
END { if (count > 0) printf "Average,%.2f,%.2f\n", total_height/count, total_weight/count }' "$output_csv" \
| sed 's/Average/Average of all PokÃ©mon/' >> "$output_csv"

echo "Report generated: $output_csv"
