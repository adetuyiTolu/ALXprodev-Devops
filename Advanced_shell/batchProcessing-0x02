#!/bin/bash

# List of Pokémon to fetch
pokemons=("Bulbasaur" "Ivysaur" "Venusaur" "Charmander" "Charmeleon")

# API endpoint
base_url="https://pokeapi.co/api/v2/pokemon"

# Log file for errors
error_log="errors.txt"

# Ensure error log is empty at start
> "$error_log"

# Loop through Pokémon list
for pokemon in "${pokemons[@]}"; do
    pokemon_lower=$(echo "$pokemon" | tr '[:upper:]' '[:lower:]')
    output_file="${pokemon_lower}.json"

    attempt=1
    success=false

    while [ $attempt -le 3 ]; do
        echo "Fetching data for $pokemon (Attempt $attempt)..."
        
        # Use -sS for silent except errors, -f to fail on HTTP errors
        if curl -sSf "$base_url/$pokemon_lower" -o "$output_file"; then
            echo "Successfully fetched $pokemon."
            success=true
            break
        else
            echo "Attempt $attempt for $pokemon failed."
            ((attempt++))
            sleep 2  # Wait before retry
        fi
    done

    if [ "$success" = false ]; then
        echo "$pokemon: Failed to fetch after 3 attempts" >> "$error_log"
    fi

    sleep 1  # Delay to prevent API rate-limiting
done

echo "Done. Errors (if any) logged in $error_log."
